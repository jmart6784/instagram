<h1>Post Index</h1>

<%= link_to "New Post", new_post_path %>
<br /><br />
<%= link_to "Sign in", new_user_session_url %>
<%= link_to "Sign up", new_user_registration_url %>

<br /><br />

<table>
  <thead>
    <tr>
      <th>Username</th>
      <th>Caption</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody>
    <% @post.each do |post| %>
      <% user = User.find(post.user_id) %>
      <tr>
        <td><%= link_to user.username, user %></td>
        <td><%= link_to post.caption, post %></td>
        <td><%= post.comments.length %></td>

        <td>
          <% like_exists = Like.where(post_id: post.id, user_id: current_user.id) == [] ? "Like" : "Unlike" %>

          <%= link_to like_exists, ajax_likes_update_like_path(id: post.id, type: "post", html_id: "likeable_id_#{post.id}", html_count_id: "like_count#{post.id}"), method: :put, remote: true, id: "likeable_id_#{post.id}" %>
        </td>

        <td>
          <p id=<%= "like_count#{post.id}" %>>
            <%= "#{post.likes.count} Like".pluralize(post.likes.count) %>
          </p>
        </td>

        <% if current_user === user %>
          <td>
            <%= link_to "Edit", edit_post_url(post) %>
          </td>
          <td>
            <%= link_to "Delete", post, method: :delete, data: { confirm: 'Are you sure?' } %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
