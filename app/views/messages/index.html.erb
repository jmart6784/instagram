<% sender = User.find(@conversation.sender_id) %>
<% recipient = User.find(@conversation.recipient_id) %>

<h2>Now messaging: <%= current_user === sender ? "#{recipient.first_name} #{recipient.last_name}" : "#{sender.first_name} #{sender.last_name}" %></h2>

<% if @over_ten %>
  <%= link_to "Show older messages", '?m=all' %>
<% end %>


<% @messages.each do |message| %>
  <% if message.body %>
    <% user = User.find(message.user_id) %>
    <h4><%= current_user === user ? "You" : user.username %></h4>
    <h3><%= message.body %></h3>
    <h4><%= message.created_at.strftime("%B %e, %Y %H:%M:%S%p") %></h4>

    <% if current_user.id === message.user_id %>
      <h4><%= link_to "Delete", conversation_message_path(@conversation.id, message.id), method: :delete, data: { confirm: 'Are you sure?' } %></h4>
    <% end %>
    <br /><br />
  <% end %>
<% end %>


<%= form_for [@conversation, @message] do |f| %>
  <%= f.text_area :body %>
  <%= f.submit "Send" %>
<% end %>